syntax = "proto3";
package antarcticom.messages;

import "google/protobuf/timestamp.proto";

// A text message in a channel.
message Message {
  int64 id = 1;                          // Snowflake ID
  string channel_id = 2;                 // UUID
  string author_id = 3;                  // UUID
  bytes content = 4;                     // Encrypted content (E2EE) or plaintext
  bytes nonce = 5;                       // Encryption nonce
  google.protobuf.Timestamp created_at = 6;
  google.protobuf.Timestamp edited_at = 7;
  int64 reply_to_id = 8;                // 0 = no reply
  repeated Reaction reactions = 9;
  repeated Mention mentions = 10;
}

message Reaction {
  string emoji = 1;
  repeated string user_ids = 2;         // UUIDs of users who reacted
  int32 count = 3;
}

message Mention {
  MentionType type = 1;
  string id = 2;                         // UUID of mentioned entity
}

enum MentionType {
  MENTION_USER = 0;
  MENTION_ROLE = 1;
  MENTION_CHANNEL = 2;
}

// Request to send a message.
message SendMessage {
  string channel_id = 1;
  bytes content = 2;
  bytes nonce = 3;
  int64 reply_to_id = 4;
}

// Request to fetch message history.
message FetchMessages {
  string channel_id = 1;
  int64 before = 2;                      // Snowflake ID cursor
  int32 limit = 3;                       // Max 100
}

message MessageBatch {
  repeated Message messages = 1;
  bool has_more = 2;
}
