syntax = "proto3";
package antarcticom.events;

import "google/protobuf/timestamp.proto";

// WebSocket gateway event wrapper.
message GatewayEvent {
  string type = 1;                       // Event type name
  uint64 sequence = 2;                   // Monotonic sequence number
  bytes data = 3;                        // Serialized event payload
}

// Sent by client to authenticate the WebSocket connection.
message Identify {
  string token = 1;
}

// Sent by server after successful identification.
message Ready {
  string session_id = 1;
  UserInfo user = 2;
  repeated ServerInfo servers = 3;
}

message UserInfo {
  string id = 1;
  string username = 2;
  string display_name = 3;
  string avatar_hash = 4;
  PresenceStatus status = 5;
}

message ServerInfo {
  string id = 1;
  string name = 2;
  string icon_hash = 3;
  string owner_id = 4;
  repeated ChannelInfo channels = 5;
}

message ChannelInfo {
  string id = 1;
  string name = 2;
  ChannelType type = 3;
  int32 position = 4;
}

enum ChannelType {
  TEXT = 0;
  VOICE = 1;
  ANNOUNCEMENT = 2;
}

enum PresenceStatus {
  ONLINE = 0;
  IDLE = 1;
  DND = 2;
  OFFLINE = 3;
}

// Heartbeat (client → server).
message Heartbeat {
  uint64 sequence = 1;
}

// Heartbeat acknowledgement (server → client).
message HeartbeatAck {}

// Presence update event.
message PresenceUpdate {
  string user_id = 1;
  PresenceStatus status = 2;
}

// Typing indicator event.
message TypingStart {
  string channel_id = 1;
  string user_id = 2;
  google.protobuf.Timestamp timestamp = 3;
}
