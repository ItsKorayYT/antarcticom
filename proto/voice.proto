syntax = "proto3";
package antarcticom.voice;

// Voice signaling messages (sent over QUIC bidirectional stream).
message VoiceSignal {
  oneof signal {
    JoinChannel join = 1;
    LeaveChannel leave = 2;
    UpdateState update_state = 3;
    SpeakingState speaking = 4;
    SessionDescription session_desc = 5;
  }
}

message JoinChannel {
  string channel_id = 1;
  string auth_token = 2;
  uint32 ssrc = 3;                       // Client-proposed SSRC
}

message LeaveChannel {
  string channel_id = 1;
}

message UpdateState {
  bool muted = 1;
  bool deafened = 2;
}

message SpeakingState {
  bool speaking = 1;
  uint32 ssrc = 2;
}

message SessionDescription {
  string mode = 1;                       // "aes256_gcm"
  bytes secret_key = 2;                  // Session encryption key
}

// Voice data frame (sent over QUIC unidirectional streams).
message VoiceFrame {
  uint32 ssrc = 1;                       // Source identifier
  uint64 sequence = 2;                   // Frame counter (for nonce)
  uint32 timestamp = 3;                  // RTP-style timestamp (48kHz)
  bytes opus_data = 4;                   // Encrypted Opus frame
  bool is_silence = 5;                   // Comfort noise frame
}

// Server response: voice server info for connecting.
message VoiceServerInfo {
  string endpoint = 1;                   // QUIC endpoint address
  string token = 2;                      // Session token
  uint32 ssrc = 3;                       // Server-assigned SSRC
}
